"use strict";(self["webpackChunkmihua"]=self["webpackChunkmihua"]||[]).push([[948],{8948:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var a=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%",height:"100%",padding:"20px","box-sizing":"border-box"}},[t("div",{staticClass:"main"},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[t("div",[e._m(0),t("el-input",{staticStyle:{width:"400px","margin-left":"20px"},attrs:{placeholder:"请输入角色名称进行模糊搜察"},on:{input:function(t){return e.sear({rolename:e.search})}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!0}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 添加系统角色")]),t("el-dialog",{staticStyle:{width:"100%",margin:"0 auto"},attrs:{visible:e.dialogFormVisible,title:e.xgid?"编辑系统角色":"添加系统角色",lockScroll:!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"100%"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"rolename"}},[t("el-input",{staticStyle:{width:"270px"},model:{value:e.ruleForm.rolename,callback:function(t){e.$set(e.ruleForm,"rolename",t)},expression:"ruleForm.rolename"}})],1),t("el-form-item",{attrs:{label:"角色描述",prop:"describe"}},[t("el-input",{staticStyle:{width:"270px"},model:{value:e.ruleForm.describe,callback:function(t){e.$set(e.ruleForm,"describe",t)},expression:"ruleForm.describe"}})],1),t("el-form-item",{attrs:{label:"角色权限",prop:"powers"}},[t("el-tree",{ref:"tree",attrs:{data:e.data,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"","default-checked-keys":e.checkList}})],1),t("el-form-item",{attrs:{label:"角色状态",prop:"status"}},[t("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v("启动")]),t("el-radio",{attrs:{label:"0"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v("停用")])],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("立即提交")]),t("el-button",{on:{click:e.qk}},[e._v("取消提交")])],1)],1)],1)],1),t("div",[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{select:e.dan,"select-all":e.quan}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"rolename",label:"角色名称",width:"120",align:"center"}}),t("el-table-column",{attrs:{prop:"describe",label:"角色描述","show-overflow-tooltip":"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(""==t.row.describe?"--":t.row.describe)+" ")]}}])}),t("el-table-column",{attrs:{prop:"powers",label:"角色权限配置","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"status",label:"角色启用状态","show-overflow-tooltip":"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{class:1==s.row.status?"lan":"bai",staticStyle:{width:"10px",height:"10px","border-radius":"50%",float:"left",position:"relative",top:"6px",left:"60px"}}),e._v(" "+e._s(1==s.row.status?"启用中":"已停用")+" ")]}}])}),t("el-table-column",{attrs:{prop:"lasttime",align:"center",label:"最后编辑时间","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.xghx(s.row.id)}}}),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.del(s.row)}}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:0==s.row.status?"primary":"info",icon:0==s.row.status?"el-icon-video-play":"el-icon-video-pause"},on:{click:function(t){return e.upstat(s.row)}}})]}}])})],1)],1),t("div",{staticClass:"fenye"},[t("div",[t("p",[e._v("已选 "),t("span",[e._v(" "+e._s(e.num)+" ")]),e._v(" 条")]),t("span",[t("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.alldel.apply(null,arguments)}}},[e._v("批量删除")])]),t("span",[t("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.allpi.apply(null,arguments)}}},[e._v("批量启用")]),e._v("/"),t("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.allti.apply(null,arguments)}}},[e._v("停用角色")])])]),t("el-pagination",{attrs:{"page-size":10,layout:"total,sizes, prev, pager, next","page-sizes":[10,20,30,40],total:e.yes,"current-page":e.currentPage},on:{"current-change":e.fy,"size-change":e.jt,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)])])},i=[function(){var e=this,t=e._self._c;return t("select",{staticStyle:{width:"150px",height:"40px","background-color":"#E9F3FB",color:"#229DFF",border:"none",padding:"10px"},attrs:{name:"",id:""}},[t("option",{staticStyle:{"background-color":"white",color:"black"},attrs:{value:""}},[e._v("角色状态")])])}],r=s(412);function l(e){return new Promise((t=>{(0,r.$)("role/addroles",e).then((e=>{t(e)}))}))}function n(e){return new Promise((t=>{(0,r.V)("role/getroleslist",e).then((e=>{t(e)}))}))}function o(e){return new Promise((t=>{(0,r.V)(`role/delroles?id=${e}`).then((e=>{t(e)}))}))}function c(e){return new Promise((t=>{(0,r.$)(`role/getrolesbyid?id=${e}`).then((e=>{t(e)}))}))}function h(e){return new Promise((t=>{(0,r.$)("role/uproles",e).then((e=>{t(e)}))}))}function u(e){return new Promise((t=>{(0,r.$)("role/stoproles",e).then((e=>{t(e)}))}))}function g(e){return new Promise((t=>{(0,r.$)("/role/getsearchroles",e).then((e=>{t(e)}))}))}var m={data(){return{data:[{id:1,label:"首页"},{id:2,label:"企业管理"},{id:3,label:"通话权限",children:[{id:4,label:"并发统计"}]},{id:5,label:"权限管理",children:[{id:6,label:"系统角色管理"},{id:7,label:"系统用户管理"}]}],checkList:[],currentPage:1,search:"",tableData:[],arr:[],num:0,xgid:"",yes:0,yds:10,dialogFormVisible:!1,ruleForm:{rolename:"",describe:"",powers:"",status:""},all:[],rules:{rolename:[{required:!0,message:"请输入姓名",trigger:"blur"}],powers:[{required:!0,message:"请输入权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}}},created(){this.get()},methods:{jt(e){this.yds=e,this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})},fy(e){this.search?this.sear({page:e,rolename:this.search,pagelimit:this.yds}):this.get({page:e,pagelimit:this.yds})},get(e){n(e).then((e=>{this.tableData=e.data.data,this.tableData&&(this.yes=e.data.pagecount,this.tableData.forEach((e=>{var t=new Date(1e3*e.lasttime);e.lasttime=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();var s="";e.powers.split(",").forEach((e=>{"1"==e?s+="首页, ":"2"==e?s+="企业管理, ":"3"==e?s+="通话统计, ":"4"==e?s+="并发统计, ":"5"==e?s+="权限管理, ":"6"==e?s+="系统角色管理, ":"7"==e&&(s+="系统用户管理, ")})),e.powers=s})))}))},qk(){this.dialogFormVisible=!1,this.ruleForm={rolename:"",describe:"",powers:"",status:""},this.checkList=[],console.log(this.checkList),this.$refs.tree.getCheckedKeys(),this.$refs.tree.setCheckedKeys([]),this.xgid=""},dan(e){this.num=e.length,this.all=e},quan(e){this.num=e.length,this.all=e},submitForm(){if(this.checkList=this.$refs.tree.getCheckedKeys(),console.log(this.checkList),this.ruleForm.powers=this.checkList.join(","),""==this.xgid)l(this.ruleForm).then((e=>{console.log(e),0==e.code?(this.qk(),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds}),this.$message({showClose:!0,message:"提交成功"})):this.$message({showClose:!0,message:"提交失败"})}));else{var e={id:this.xgid,rolename:this.ruleForm.rolename,describe:this.ruleForm.describe,powers:this.checkList.join(","),status:this.ruleForm.status};h(e).then((e=>{0==e.code?(this.qk(),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds}),this.$message({showClose:!0,message:"修改成功"})):this.$message({showClose:!0,message:"修改失败"})}))}},del(e){this.$confirm(`删除后，${e.rolename} 将不再具备角色相应权限`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{o(e.id).then((e=>{console.log(e),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})})),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},xghx(e){this.xgid=e,c(e).then((e=>{this.ruleForm.rolename=e.data.rolename,this.ruleForm.describe=e.data.describe,this.checkList=e.data.powers.split(","),this.ruleForm.status=e.data.status})),this.dialogFormVisible=!0},upstat(e){1==e.status?this.$confirm(`确认停用 ${e.rolename} 角色?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{u({id:e.id,status:0}).then((e=>{console.log(e),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})})),this.$message({type:"success",message:"停用成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消停用"})})):u({id:e.id,status:1}).then((e=>{console.log(e),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds}),this.$message({type:"info",message:"启用成功"})}))},alldel(){0==this.all.length?this.$message({type:"info",message:"请选择要删除的数据"}):this.$confirm("删除后，这些将不再具备角色相应权限","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.all.forEach((e=>{o(e.id).then((e=>{console.log(e)})),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})})),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},allpi(){0==this.all.length?this.$message({type:"info",message:"请选择要启用的数据"}):this.$confirm("确认启用","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.all.forEach((e=>{u({id:e.id,status:1}).then((e=>{console.log(e),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})})),this.get()})),this.$message({type:"success",message:"启用成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消启用"})}))},allti(){0==this.all.length?this.$message({type:"info",message:"请选择要停用的数据"}):this.$confirm("确认停用","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.all.forEach((e=>{u({id:e.id,status:0}).then((e=>{console.log(e),this.search?this.sear({page:this.currentPage,rolename:this.search,pagelimit:this.yds}):this.get({page:this.currentPage,pagelimit:this.yds})})),this.get()})),this.$message({type:"success",message:"停用成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消停用"})}))},sear(e){g(e).then((e=>{this.tableData=e.data.data,this.yes=e.data.pagecount,this.tableData&&(this.yes=e.data.pagecount,this.tableData.forEach((e=>{var t=new Date(1e3*e.lasttime);e.lasttime=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();var s="";e.powers.split(",").forEach((e=>{"1"==e?s+="首页, ":"2"==e?s+="企业管理, ":"3"==e?s+="通话统计, ":"4"==e?s+="并发统计, ":"5"==e?s+="权限管理, ":"6"==e?s+="系统角色管理, ":"7"==e&&(s+="系统用户管理, ")})),e.powers=s})))}))}}},d=m,p=s(1656),f=(0,p.A)(d,a,i,!1,null,"2ad8bdf0",null),b=f.exports},412:function(e,t,s){s.d(t,{$:function(){return r},V:function(){return i}});var a=s(8355);function i(e,t){return new Promise(((s,i)=>{(0,a.A)({method:"get",url:e,params:t}).then((e=>{s(e.data)})).catch((e=>{i(e.data)}))}))}function r(e,t){return new Promise(((s,i)=>{(0,a.A)({method:"post",url:e,data:t}).then((e=>{s(e.data)})).catch((e=>{i(e.data)}))}))}a.A.defaults.timeout=3e4,a.A.defaults.baseURL="https://www.zzgoodqc.cn/index.php/index/",console.log("正式"),a.A.interceptors.response.use((function(e){return e}),(function(e){return Promise.reject(e)}))}}]);
//# sourceMappingURL=948.2eedb8df.js.map